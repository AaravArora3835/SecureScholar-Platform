<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Password Security Quiz (Adaptive)</title>

  <!-- Shared styles/scripts (same folder as this file) -->
  <link rel="stylesheet" href="./modules.css" />
  <script defer src="./modules.js"></script>

  <style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; min-height: 100vh; padding: 2rem; }
    .container { max-width: 800px; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 1.5rem; }
    .quiz-card { border:1px solid rgba(0,0,0,.1); border-radius:14px; padding:1rem; margin:1rem 0; background:#fff; }
    .option { border:1px solid rgba(0,0,0,.12); border-radius:10px; padding:1rem; cursor:pointer; margin:.5rem 0; }
    .option:hover { background: rgba(0,0,0,.04); }
    .option.correct { border-color:#22c55e; background: rgba(34,197,94,.12); }
    .option.incorrect { border-color:#ef4444; background: rgba(239,68,68,.12); }
    .button { border:none; padding:1rem 1.5rem; border-radius:10px; cursor:pointer; margin:1rem auto; display:block; background:#2563eb; color:#fff; }
    .button:hover { background:#1e40af; }
    .progress { height:10px; background:#eee; border-radius:6px; overflow:hidden; margin:1rem 0; }
    .progress > div { height:100%; width:0%; background:#fbbf24; transition: width .3s ease; }
    .nav { display:flex; gap:.75rem; flex-wrap:wrap; margin-top:1rem; }
    .nav a { background:#2563eb; color:#fff; padding:.5rem 1rem; border-radius:8px; text-decoration:none; }
    .nav a:hover { background:#1e40af; }

    /* Adaptive toasts + hint modal (lightweight styles) */
    .adaptive-msg{
      position:fixed; left:50%; top:12%; transform:translateX(-50%);
      background:#111827; color:#fff; padding:.6rem 1rem; border-radius:10px;
      box-shadow:0 10px 28px rgba(0,0,0,.25); z-index:9999; font-weight:600;
    }
    .hint-modal{
      position:fixed; inset:0; display:grid; place-items:center; z-index:9998;
      background:rgba(15,23,42,.55);
    }
    .hint-modal > div{
      background:#ffffff; color:#111827; width:min(92%,360px);
      border-radius:14px; padding:1.2rem 1.4rem; box-shadow:0 12px 40px rgba(0,0,0,.4);
    }
    .hint-modal h3{ margin:.2rem 0 .6rem; }
    .hint-modal button{
      background:#2563eb; color:#fff; border:0; border-radius:10px; padding:.55rem .9rem; cursor:pointer;
    }
    @media (prefers-color-scheme: dark){
      body{ background: linear-gradient(135deg,#0f172a,#111827); color:#e5e7eb; }
      .quiz-card{ background:#0b1220; border-color: rgba(255,255,255,.08); }
      .option{ border-color: rgba(255,255,255,.12); }
      .option:hover{ background: rgba(255,255,255,.06); }
      .hint-modal > div{ background:#0b1220; color:#e6e8ee; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîí Password Security Quiz</h1>
      <p>Adaptive mode: questions get easier or harder based on how you‚Äôre doing.</p>
    </div>

    <!-- Quiz progress (per-question) -->
    <div class="progress"><div id="progressFill"></div></div>

    <div id="quiz"></div>

    <button class="button" id="nextBtn" style="display:none" onclick="nextQ()">Next Question</button>
    <button class="button" id="finishBtn" style="display:none" onclick="finish()">See Results</button>

    <div id="results" style="text-align:center; font-size:1.2rem; margin-top:1rem; display:none;"></div>

    <div class="nav">
      <a href="./module1.html">‚Üê Back to Module 1</a>
    </div>
  </div>

  <!-- 1) Load adaptive engine AFTER modules.js (so it can coexist) -->
  <script src="../js/adaptive-quiz.js"></script>

  <script>
    /* ---------------- Confetti + Achievement Modal ---------------- */
    function confettiBurst(){
      const N=60, colors=["#7B61FF","#7C8CF6","#22C55E","#FBBF24","#EF4444"];
      for(let i=0;i<N;i++){
        const s=document.createElement("span");
        s.style.cssText=`
          position:fixed;left:50%;top:45%;
          width:8px;height:8px;border-radius:2px;
          background:${colors[i%colors.length]};
          transform:translate(-50%,-50%);
          pointer-events:none;z-index:9999;
          animation:confetti-fall .9s ease-out forwards;
        `;
        s.style.setProperty("--dx",`${(Math.random()*2-1)*120}px`);
        s.style.setProperty("--dy",`${80+Math.random()*120}px`);
        document.body.appendChild(s);
        setTimeout(()=>s.remove(),1200);
      }
    }
    function showAchievement(){
      const overlay = document.createElement("div");
      overlay.className = "achv-overlay";
      overlay.innerHTML = `
        <div class="achievement-modal">
          <div class="emoji">üèÜ</div>
          <h3>Achievement Unlocked</h3>
          <p>Password Pro ‚Äî you passed the quiz!</p>
          <button class="achv-close">Nice!</button>
        </div>
      `;
      document.body.appendChild(overlay);
      overlay.querySelector(".achv-close").addEventListener("click", () => overlay.remove());
    }
    /* ---------------------------------------------------------------- */

    // 2) Question bank WITH difficulty + hint (beginner / intermediate / advanced)
    const quizData = [
      { id:1, difficulty:'beginner', text:"What's the minimum recommended password length?", options:["6","8","12","20"], answer:2, hint:"Longer = stronger. Aim for 12+." , x:"12+ characters is the modern baseline for strong passwords." },
      { id:2, difficulty:'beginner', text:"2FA stands for‚Ä¶", options:["Two-Factor Authentication","Two-File Access","Total Factor Authorization","Trusted Friend Access"], answer:0, hint:"It‚Äôs about adding a second factor beyond the password.", x:"A second factor (something you have/are) added to your password (something you know)." },
      { id:3, difficulty:'beginner', text:"Using the same strong password on all sites is safe.", options:["True","False"], answer:1, hint:"If one site is breached, others fall like dominos.", x:"If one site is breached, attackers try the same password everywhere." },

      { id:4, difficulty:'intermediate', text:"Which is the BEST type of 2FA?", options:["SMS codes","Email codes","Authenticator app","Hardware key"], answer:3, hint:"Think: phishing-resistant, physical device.", x:"Hardware security keys resist phishing and SIM-swaps; apps are second-best." },
      { id:5, difficulty:'intermediate', text:"A password manager primarily helps by‚Ä¶", options:["Sending password resets","Storing/generating unique passwords securely","Creating accounts for you","Blocking phishing emails"], answer:1, hint:"It‚Äôs a secure vault + generator.", x:"Use it to generate and store unique passwords for every site." },
      { id:6, difficulty:'intermediate', text:"‚Äòpassword123‚Äô is weak mainly because‚Ä¶", options:["It has numbers","It‚Äôs too short and common","It uses only lowercase","It‚Äôs hard to type"], answer:1, hint:"Attackers guess common + predictable combos first.", x:"Common words + predictable numbers are first in attacker wordlists." },

      { id:7, difficulty:'advanced', text:"Why is 'correct-horse-battery-staple-2025' strong?", options:["It uses symbols","It‚Äôs long and less predictable","It‚Äôs all caps","It has your birth year"], answer:1, hint:"Search space grows with random, unrelated words.", x:"Length dominates strength‚Äîseveral unrelated words expand the search space." },
      { id:8, difficulty:'advanced', text:"Which accounts should have 2FA at minimum?", options:["Email","Banking","Social media","All of the above"], answer:3, hint:"Protect the keys to your identity + money.", x:"Enable 2FA anywhere possible, especially email, banking, and socials." },
      { id:9, difficulty:'advanced', text:"Browser password managers are always equal to dedicated ones.", options:["True","False"], answer:1, hint:"Dedicated tools usually have stronger features.", x:"Dedicated managers usually have stronger features and cross-platform support." },

      // one bonus to ensure enough pool
      { id:10, difficulty:'intermediate', text:"Best practice for passphrases:", options:["Short + complex","Long + random words","All symbols","Uppercase only"], answer:1, hint:"Think about memorability + entropy.", x:"Long passphrases with unrelated words are both strong and memorable." }
    ];

    // 3) Adaptive engine instance
    const aq = new AdaptiveQuiz(quizData);

    // quiz run-state
    const TOTAL_QUESTIONS = 10; // how many to ask this run
    let count = 0;              // asked so far
    let score = 0;
    let answered = false;
    let currentQ = null;
    const askedIds = new Set();

    // pick next question guided by adaptive engine (no repeats)
    function pickNextQuestion(){
      let tries = 0;
      let q;
      do {
        q = aq.getNextQuestion();
        tries++;
        if (tries > 50) break; // fallback safety
      } while (askedIds.has(q.id));
      askedIds.add(q.id);
      return q;
    }

    function updateQuizProgress(){
      const pct = Math.round((count / TOTAL_QUESTIONS) * 100);
      document.getElementById("progressFill").style.width = pct + "%";
    }

    function loadQ(){
      if (count === 0){
        currentQ = pickNextQuestion();
      }
      const root = document.getElementById('quiz');
      let html = `
        <div class="quiz-card">
          <div><strong>Question ${count + 1} of ${TOTAL_QUESTIONS}</strong> <span style="opacity:.7">(${currentQ.difficulty})</span></div>
          <p style="margin:.6rem 0 1rem">${currentQ.text}</p>
      `;
      currentQ.options.forEach((opt, idx) => {
        html += `<div class="option" onclick="selectA(${idx})">${String.fromCharCode(65+idx)}) ${opt}</div>`;
      });
      html += `<div id="fb" style="margin-top:.8rem;display:none"></div></div>`;
      root.innerHTML = html;

      document.getElementById("nextBtn").style.display = (count < TOTAL_QUESTIONS - 1) ? "block" : "none";
      document.getElementById("finishBtn").style.display = (count === TOTAL_QUESTIONS - 1) ? "block" : "none";
      answered = false;
      updateQuizProgress();
    }

    function selectA(idx){
      if (answered) return;
      answered = true;

      const opts = document.querySelectorAll(".option");
      const fb = document.getElementById("fb");
      const isCorrect = (idx === currentQ.answer);

      if (isCorrect) {
        opts[idx].classList.add("correct");
        fb.textContent = "‚úÖ Correct. " + (currentQ.x || "");
        score += 10;
      } else {
        opts[idx].classList.add("incorrect");
        opts[currentQ.answer].classList.add("correct");
        fb.textContent = "‚ùå Not quite. " + (currentQ.x || "");
      }
      fb.style.display = "block";

      // Tell the adaptive engine how we did
      aq.evaluatePerformance(isCorrect);
    }

    function nextQ(){
      // advance counter, pick next based on current level
      count++;
      currentQ = pickNextQuestion();
      loadQ();
    }

    function finish(){
      const total = TOTAL_QUESTIONS * 10;
      const pct = Math.round((score / total) * 100);

      if (window.SS){
        if (pct >= 70) SS.awardPoints(50); // pass bonus
        if (pct === 100) SS.awardPoints(25); // perfect bonus
        SS.setQuizScore(score);
      }

      if (pct >= 70){
        confettiBurst();
        showAchievement();
      }

      const r = document.getElementById("results");
      r.style.display = "block";
      r.innerHTML = `
        <div>Your Score: <strong>${score}/${total}</strong> (${pct}%)</div>
        <button class="button" onclick="location.reload()">Try Again</button>
      `;

      // hide quiz UI
      document.getElementById("quiz").style.display = "none";
      document.getElementById("nextBtn").style.display = "none";
      document.getElementById("finishBtn").style.display = "none";
      document.getElementById("progressFill").style.width = "100%";
    }

    // boot
    document.addEventListener("DOMContentLoaded", () => {
      // first question is picked inside loadQ (via pickNextQuestion if count===0)
      currentQ = pickNextQuestion();
      loadQ();
    });
  </script>
</body>
</html>
